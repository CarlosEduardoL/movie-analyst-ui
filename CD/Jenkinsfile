pipeline {
    agent {
        docker { 
            image 'zeronetdev/rampup-provcli:0.0.1'
            args '-u root -v /home/ubuntu/RampUp/ansible/playbooks:/playbooks -v /home/ubuntu/.aws:/root/.aws -v /home/ubuntu/.ssh:/root/._ssh -v /home/ubuntu/tags:/tags'
        }
    }
    stages {
        stage("deploy"){
            steps {
                sh 'cp -r /root/._ssh /root/.ssh'
                sh 'chown root -R /root/.ssh'
                sh 'echo "cd /playbooks" >> script.sh'
                sh "echo \"ansible-playbook -i inventory_aws_ec2.yml -u ubuntu -e tag=${params.TAG} front.yml\" >> script.sh"
                sh 'chmod +x script.sh'
                sh './script.sh'
                sh "echo front_tag::${params.TAG} > /tags"
            }
        }
    }
}